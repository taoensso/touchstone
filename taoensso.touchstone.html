<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>taoensso.touchstone documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Touchstone</span> <span class="project-version">2.1.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>taoensso</span></div></div></li><li class="depth-2 current"><a href="taoensso.touchstone.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>touchstone</span></div></a></li><li class="depth-3 branch"><a href="taoensso.touchstone.ring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></a></li><li class="depth-3"><a href="taoensso.touchstone.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.touchstone.html#var-*ts-id*"><div class="inner"><span>*ts-id*</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-ab-select"><div class="inner"><span>ab-select</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-commit.21"><div class="inner"><span>commit!</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-delete-test"><div class="inner"><span>delete-test</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-mab-select"><div class="inner"><span>mab-select</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-mab-select-id"><div class="inner"><span>mab-select-id</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-mab-select-ordered"><div class="inner"><span>mab-select-ordered</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-mab-select-permutations"><div class="inner"><span>mab-select-permutations</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-move-test"><div class="inner"><span>move-test</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-pr-results"><div class="inner"><span>pr-results</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-select-form.21"><div class="inner"><span>select-form!</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-selected-form-id"><div class="inner"><span>selected-form-id</span></div></a></li><li class="depth-1"><a href="taoensso.touchstone.html#var-with-test-subject"><div class="inner"><span>with-test-subject</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">taoensso.touchstone</h1><div class="doc"><pre class="plaintext">Simple, Carmine-backed Multi-Armed Bandit (MAB) split-testing. Both more
effective and more convenient than traditional A/B testing. Fire-and-forget!

Redis keys:
  * touchstone:&lt;test-id&gt;:nprospects -&gt; hash, {form-id count}
  * touchstone:&lt;test-id&gt;:scores     -&gt; hash, {form-id score}
  * touchstone:&lt;test-id&gt;:&lt;ts-id&gt;:selection  -&gt; ttl string, form-id
  * touchstone:&lt;test-id&gt;:&lt;ts-id&gt;:committed? -&gt; ttl flag

Ref. <a href="http://goo.gl/XPlP6">http://goo.gl/XPlP6</a> (UCB1 MAB algo)
     <a href="http://en.wikipedia.org/wiki/Multi-armed_bandit">http://en.wikipedia.org/wiki/Multi-armed_bandit</a>
     <a href="http://stevehanov.ca/blog/index.php?id=132">http://stevehanov.ca/blog/index.php?id=132</a></pre></div><div class="public anchor" id="var-*ts-id*"><h3>*ts-id*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Test subject id
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L29">view source</a></div></div><div class="public anchor" id="var-ab-select"><h3>ab-select</h3><h4 class="type">macro</h4><div class="usage"><code>(ab-select config ts-id test-id &amp; id-form-pairs)</code></div><div class="doc"><pre class="plaintext">Like `mab-select` but uses simple, A/B-style random selection. Unless you
know all the implications, you probably want `mab-select` instead.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L228">view source</a></div></div><div class="public anchor" id="var-commit.21"><h3>commit!</h3><div class="usage"><code>(commit! {:keys [conn ttl-ms non-uniques?], :or {ttl-ms (* 1000 60 60 2)}, :as config} ts-id test-id value)</code><code>(commit! config ts-id test-id value &amp; id-value-pairs)</code></div><div class="doc"><pre class="plaintext">Signals the occurrence of one or more events, each of which may contribute
a specified value (-1 &lt;= value &lt;= 1) to a test score:

    ;; On sign-up button click:
    (commit! {} *ts-id* :my-app.landing.buttons/sign-up 1
                        :my-app.landing/title           0.5)

    ;; On buy button click:
    (commit! {} *ts-id* :my-app/sale-price (if (&gt;= order-item-qty 2) 1 0.8))

There's great flexibility in this to model all kinds of single or multivariate
test-&gt;event interactions. Any event can contribute to the score of any test,
positively or negatively, to any extent.

The statistics can get complicated so try keep things simple: resist the urge
to get fancy with the spices.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L149">view source</a></div></div><div class="public anchor" id="var-delete-test"><h3>delete-test</h3><div class="usage"><code>(delete-test {:keys [conn]} test-id)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L308">view source</a></div></div><div class="public anchor" id="var-mab-select"><h3>mab-select</h3><h4 class="type">macro</h4><div class="usage"><code>(mab-select config ts-id test-id &amp; id-form-pairs)</code></div><div class="doc"><pre class="plaintext">Defines a test that selects and evaluates one of the testing forms using the
"UCB1" selection algorithm:
   (mab-select {} *ts-id* :my-test-1
               :my-form-1 "String 1"
               :my-form-2 (do (Thread/sleep 2000) "String 2"))

 Dependent tests can be created through composition:
   (mab-select {} *ts-id* :my-test-1
               :my-form-1 "String 1"
               :my-form-2 (mab-select {} *ts-id* :my-test-1a ...))

 Test forms can be freely added, reordered, or removed for an ongoing test at
 any time, but avoid changing a particular form once id'd.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L211">view source</a></div></div><div class="public anchor" id="var-mab-select-id"><h3>mab-select-id</h3><h4 class="type">macro</h4><div class="usage"><code>(mab-select-id config ts-id test-id &amp; ids)</code></div><div class="doc"><pre class="plaintext">Like `mab-select` but takes only form ids and uses each id also as its form.
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L234">view source</a></div></div><div class="public anchor" id="var-mab-select-ordered"><h3>mab-select-ordered</h3><h4 class="type">macro</h4><div class="usage"><code>(mab-select-ordered config ts-id test-id &amp; ordered-forms)</code></div><div class="doc"><pre class="plaintext">Like `mab-select` but takes un-id'd forms and automatically ids them by their
order: :form-1, :form-2, ....</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L239">view source</a></div></div><div class="public anchor" id="var-mab-select-permutations"><h3>mab-select-permutations</h3><h4 class="type">macro</h4><div class="usage"><code>(mab-select-permutations config ts-id test-id take-n &amp; ordered-forms)</code></div><div class="doc"><pre class="plaintext">Advanced. Defines a positional test with N!/(N-n)! testing forms. Each
testing form will be a vector permutation of the given `ordered-forms`,
automatically id'd for the order of its constituent forms.

Useful for testing the order of the first n forms out of N. The remaining
forms will retain their natural order.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L259">view source</a></div></div><div class="public anchor" id="var-move-test"><h3>move-test</h3><div class="usage"><code>(move-test {:keys [conn]} old-id new-id)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L312">view source</a></div></div><div class="public anchor" id="var-pr-results"><h3>pr-results</h3><div class="usage"><code>(pr-results {:keys [conn], :as config} test-id)</code><code>(pr-results config test-id &amp; more)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L186">view source</a></div></div><div class="public anchor" id="var-select-form.21"><h3>select-form!</h3><h4 class="type">macro</h4><div class="usage"><code>(select-form! config strategy-fn ts-id test-id id-form-pairs)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L67">view source</a></div></div><div class="public anchor" id="var-selected-form-id"><h3>selected-form-id</h3><div class="usage"><code>(selected-form-id {:keys [conn]} ts-id test-id)</code></div><div class="doc"><pre class="plaintext">Returns subject's currently selected form id for test, or nil. One common
idiom is to use this for creating dependent tests:
    (case (selected-form-id {} *ts-id* :my-test-1)
      :my-form-1 (mab-select {} *ts-id* :my-test-1a ...)
      :my-form-2 (mab-select {} *ts-id* :my-test-1b ...)
      nil)</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L74">view source</a></div></div><div class="public anchor" id="var-with-test-subject"><h3>with-test-subject</h3><h4 class="type">macro</h4><div class="usage"><code>(with-test-subject id &amp; body)</code></div><div class="doc"><pre class="plaintext">Executes body within the context of thread-local test-subject-id binding.
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/carmine/blob/master/src/taoensso/touchstone.clj#L30">view source</a></div></div></div></body></html>